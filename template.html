<!DOCTYPE html>
<html lang="en">
<head sparky-fn="import:package.json" class="{[name]}">
	<meta charset="utf-8" />
	<meta name="author" content="@{[author.twitter]}" />
	<meta name="description" content="Documentation for {[title]}. {[description]}" />
	<meta name="viewport" content="width=device-width" />

	<title>{[title]}</title>

	<script>
		document.documentElement.className = 'js';
		window.DEBUG = true;
	</script>

	<link rel="icon" type="image/png" href="images/favicon.png" />
	<link rel="apple-touch-icon" href="/apple-touch-icon.png" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Mono:100,300,400,500,700" />
	<link rel="stylesheet" href="http://stephen.band/bolt/dist/bolt.css" />
	<link rel="stylesheet" href="http://stephen.band/dom/css/dom.css" />
	<link rel="stylesheet" href="./css/prism.cruncher.css" />
	<link rel="stylesheet" href="./css/docs.css" />
	<link rel="stylesheet" href="./css/tests.css" />
    <link rel="stylesheet" href="./css/theme.css" />
</head>

<body class="doc-grid grid">
	<header sparky-fn="import:package.json" class="grid-header" id="header">
		<div class="block bottom-align">
			<h1>{[title]}
			<span class="text-6">{[version]}</span></h1>
			<p class="text-8">{[description]}</p>
		</div

		><!--img class="block @2-grid-3/15 @2-grid-left-1/15 @3-grid-left-1/9 bottom-align" src="images/sparky-logo-dark.svg" /-->
	</header>

    <div sparky-fn="global:modules template:#module-doc" id="modules"></div>

    <!-- Documntation templates -->

    <template data-module="fn, id, [object]">
        <p>Returns `object`.</p>
        <script type="text/js">id(0) // -> 0</script>
    </template>

    <template data-module="fn, noop, []">
        <p>Returns `undefined`.</p>
        <script type="text/js">noop() // -> undefined</script>
    </template>

    <template data-module="fn, self, []">
        <p>Returns `this`.</p>
        <script type="text/js">
        self()         // -> null
        self.apply({}) // -> {}
        </script>
    </template>

    <template data-module="fn, cache, [fn]">
        <p>Returns a function that caches output values against input values.</p>
        <script type="text/js">
        const fn = cache(function(value) {
            console.log('run!');
            return !!value;
        });

        fn(1); // Logs 'run!', returns true
        fn(1); // Returns true
        fn(2); // Logs 'run!', returns true
        </script>
    </template>

    <template data-module="fn, choose, [object]">
        <p>Returns a function that calls the function at property of `object`
        that matches it's first argument. It is called with the remaining
        arguments.</p>

        <script type="text/js">
        var fn = choose({
            'fish':  function fn1(a, b) {...},
            'chips': function fn2(a, b) {...}
        });

        fn('fish', a, b);   // Calls fn1(a, b)
        </script>

        <p>Accepts `Map` objects as well as plain objects.</p>
    </template>

    <template data-module="fn, overload, [fn, object]">
        <p>Returns a function that calls a function at the property of `object` that
        matches the result of calling `fn` (with all arguments).</p>

        <script type="text/js">
        var fn = overload(toType, {
            string: function a() {...},
            number: function b() {...}
        });

        fn('pie', 4); // Calls a('pie', 4)
        fn(1, 2);     // Calls b(1, 2)
        </script>
    </template>

    <!-- end of templates-->

    <!-- Polyfills -->

	<script src="http://stephen.band/fn/polyfills/object.assign.js"></script>
	<script src="http://stephen.band/fn/polyfills/array.find.js"></script>
	<script src="http://stephen.band/fn/polyfills/array.from.js"></script>
	<script src="http://stephen.band/fn/polyfills/array.of.js"></script>
	<script src="http://stephen.band/fn/polyfills/number.isnan.js"></script>
	<script src="http://stephen.band/fn/polyfills/number.isfinite.js"></script>
	<script src="http://stephen.band/fn/polyfills/math.log10.js"></script>
	<script src="http://stephen.band/fn/polyfills/symbol.js"></script>
	<script src="http://stephen.band/fn/polyfills/promise.js"></script>
	<script src="http://stephen.band/dom/polyfills/requestanimationframe.js"></script>
	<script src="http://stephen.band/dom/polyfills/customevent.js"></script>
	<script src="http://stephen.band/dom/polyfills/performance.js"></script>

    <!-- Dependencies -->

	<script src="../sparky/axios/dist/axios.js"></script>

    <!-- Debug -->

	<script type="module">
	import * as fn  from '../fn/fn.js';
	import * as dom from '../dom/dom.js';
	window.fn  = fn;
	window.dom = dom;
	</script>

    <!-- Preprocess -->

    <template class="remove" id="module-doc">
        <div sparky-fn="each" class="toggle-block block" toggleable id="{[section]}.{[name]}">
            <h3 class="text-5"><a href="#{[section]}.{[name]}"><code class="js">{[name]}({[params|join:', ']})</code></a></h3>
            <div sparky-fn="replace:fragment"></div>
        </div>
    </template>

    <template class="remove" id="html-code">
        <code class="html-code block" sparky-fn="template:''"></code>
    </template>

    <template class="remove" id="js-code">
        <code class="js-code block" sparky-fn="template:''"></code>
    </template>

    <template class="remove" id="css-code">
        <code class="css-code block" sparky-fn="template:''"></code>
    </template>

    <script class="remove" type="module">
    // Build the document

    // Preprocess
	import '../prism/prism.js';
	import '../sparky/libs/prism/prism.sparky.js';
    import { overload, each } from '../fn/fn.js';
    import { parseParams } from '../sparky/js/parse.js';
    import Sparky from '../sparky/sparky.js';
    import { default as dom, attribute, before, clone, create, fragmentFromTemplate, get, query, remove } from '../dom/dom.js';

    const attributeType = attribute('type');
    const htmlTemplate  = get('html-code', document).content;
    const jsTemplate    = get('js-code', document).content;
    const cssTemplate   = get('css-code', document).content;

    var modules = window.modules = query('[data-module]', document)
    .map(function(template) {
        var params   = parseParams([], attribute('data-module', template));
        var fragment = fragmentFromTemplate(template);

        remove(template);

        return {
            section: params[0],
            name:    params[1],
            params:  params[2],
            fragment: fragment
        };
    });

    modules.forEach(function(data) {
        query('[type]', data.fragment)
        .forEach(overload(attributeType, {
            'text/html': function(node) {
                var html     = node.innerHTML;
                var highlighted = Prism.highlight(html, Prism.languages.sparky);
                var code     = Sparky(clone(htmlTemplate), highlighted);
                var fragment = create('fragment', html);
                before(node, code[0]);
                before(node, fragment);
                remove(node);
            },

            'text/js': function(node) {
                var html     = node.innerHTML;
                var code     = Sparky(clone(jsTemplate), Prism.highlight(html, Prism.languages.js));
                before(node, code[0]);
                remove(node);
            },

            'text/css': function(node) {
                var html     = node.innerHTML;
                var code     = Sparky(clone(cssTemplate), Prism.highlight(html, Prism.languages.css));
                before(node, code[0]);
                remove(node);
            }
        }));
    });

    Sparky(dom.root);

    // Cleanup
    query('.remove, [data-module]', document).forEach(remove);
    </script>

    <!-- Initialise -->

	<script type="module">
	import '../dom/js/dom-activate.js';
	import '../dom/js/dom.root.js';
	import '../dom/js/dom.switchable.js';
	import '../dom/js/dom.toggleable.js';
	</script>

	<!-- Test -->

	<script type="module">
	// Run tests
	//import '../fn/test/test.js';
	//import './test/sparky.test.js';
	</script>
</body>
</html>
